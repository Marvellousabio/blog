<%- include('../partials/head.ejs') %>
<body>
  <%- include('../partials/nav.ejs') %>

  <div class="blog-details">
    <div class="blog-title">
      <div class="blog-head">
      <h2><%= blog.title %></h2>
      <p><%= blog.author %></p>
    </div>
    <a class="delete" data-doc="<%=blog._id%>">
      <img src="/trashcan.png" alt="delete icon">
    </a>
    <a href="/blogs/<%= blog._id %>/edit">Edit</a>

    </div>
    <div class="content">
      <% blog.body.split('\n').forEach(function(paragraph) { %>
    <p><%= paragraph %></p>
  <% }) %>
    </div>
    
  </div>


  <%- include('../partials/footer.ejs') %>
  <script>
    
    const trashcan=document.querySelector('a.delete');

    trashcan.addEventListener('click',(e)=>{
      e.preventDefault();

      const endpoint =`/blogs/${trashcan.dataset.doc}`;

      fetch(endpoint,{
        method:'DELETE',
      })
      .then(response=>response.json())
      .then(data =>{
        if(data.redirect){
        window.location.href=data.redirect;
    }
  })
      .catch(err=>console.log(err));
    });
     
    
    
    const update = document.querySelector('a.update');

update.addEventListener('click', (e) => {
  e.preventDefault();

  const endpoint = `/blogs/${update.dataset.doc}`;

  fetch(endpoint, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      title: "New Title",  // Replace with actual new values
      body: "Updated blog content"
    })
  })
    .then(response => response.json())
    .then(data => {
      if (data.redirect) {
        window.location.href = data.redirect;
      }
    })
    .catch(err => console.log(err));
});

    </script>
</body>
</html>
